function setFontSize() {
    var html = document.getElementsByTagName("html")[0];
    var w;
    w = document.documentElement.clientWidth || document.body.clientWidth;
    html.style.fontSize = w / 20 + "px"
}
setFontSize();
window.onresize = function() {
    setFontSize()
};
var loadingClass = function(target, loadCallBack) {
    var targetImgList = $(target + " img[src='']");
    var imgQuantity = targetImgList.length;
    console.log("imgQuantity", imgQuantity);
    var imgLoadNUm = 0;
    targetImgList.each(function() {
        this.src = $(this).attr("data-src")
    });
    targetImgList.load(function() {
        imgLoadNUm++;
        var loadingProgress = Math.floor(imgLoadNUm / imgQuantity * 100);
        loadCallBack(loadingProgress)
    });
    if (imgQuantity == 0) {
        loadCallBack(100)
    }
};
var loadingContainer;
var loadingProgress = {
    progress: 0,
    html_progress: 0,
    three_progress: 0,
    threeProgress: false,
    htmlProgress: false
};
var loading = new loadingClass("#loading", function(Progress) {
    console.log(Progress);
    if (Progress == 100) {
        $("#loading").show();
        var targetImgList = $("#content" + " img[src='']");
        var imgQuantity = targetImgList.length;
        if (imgQuantity == 0) {
            html_loadEnd()
        } else {
            loadingContainer = new loadingClass("#content", function(Progress) {
                var progress = Progress / 2;
                loadingProgress.html_progress = progress;
                console.log("content", progress);
                if (progress == 50) {
                    html_loadEnd()
                } else {
                    setProgress()
                }
            })
        }
    }
});
var notifyLoadingProgress_flag = false;

function notifyLoadingProgress(count, count2) {
    if (notifyLoadingProgress_flag) {
        var pro = Math.floor((count2 - count) / count2 * 20);
        loadingProgress.three_progress = parseInt(30) + parseInt(pro);
        console.log("notifyLoadingProgress", count, count2, loadingProgress.three_progress, pro);
        setProgress()
    }
}

function three_loadEnd() {
    notifyLoadingProgress_flag = true
}

function html_loadEnd() {
    setProgress();
    loadingProgress.htmlProgress = true;
    loadJs(0, lazyJs)
}

function setProgress() {
    loadingProgress.progress = loadingProgress.html_progress + loadingProgress.three_progress;
    $("#loadingProgress").html(Math.floor(loadingProgress.progress) + "%");
    if (loadingProgress.progress == 100) {
        // $("#loading").hide();
        // $("#container").show();
        // $("#content").show();
        // startScene()
    }
}

function simulation_three_loading() {
    if (!loadingProgress.threeProgress) {
        setTimeout(function() {
            if (loadingProgress.three_progress < 49) {
                loadingProgress.three_progress++;
                simulation_three_loading()
            }
        }, 10)
    } else {
        loadingProgress.three_progress = 50
    }
    setProgress()
}
var lazyJs = ["js/three/three.min.js?v=113002", "js/three/DDSLoader.min.js?v=113002", "js/three/MTLLoader.min.js?v=113002", "js/three/OBJLoader.min.js?v=113002", "js/three/FBXLoader.min.js?v=113002", "js/three/Detector.min.js?v=113002", "js/three/stats.min.js?v=113002", "js/Tween.min.js?v=113002", "js/inflate.min.js?v=113002", "js/RequestAnimationFrame.min.js?v=113002", "js/tweenjs-NEXT.min.js?v=113002", "js/main.min.js?v=113002"];

function loadJs(id, lazyJs) {
    if (id < lazyJs.length) {
        jQuery.getScript(lazyJs[id]).done(function() {
            console.log("加载成功", id, lazyJs[id]);
            loadJs(id + 1, lazyJs);
            loadingProgress.three_progress = (id + 1) / lazyJs.length * 29;
            setProgress()
        }).fail(function() {})
    } else {
        three_loadEnd()
    }
}

function uiSwitchPage(curPage, pageIdx) {
    console.log("..............................uiSwitchPage", curPage, pageIdx);
    // if (pageIdx < 9) {
    //     var curLi = $($("#timeLanList li")[curPage - 1]);
    //     var nextLi = $($("#timeLanList li")[pageIdx - 1]);
    //     if (curLi.hasClass("showTimeLine")) {
    //         curLi.addClass("hideTimeLine");
    //         curLi.removeClass("showTimeLine")
    //     }
    //     if (nextLi.has("hideTimeLine")) {
    //         nextLi.addClass("showTimeLine");
    //         nextLi.removeClass("hideTimeLine")
    //     }
    // }
}

function changeYear(yaer) {
    console.log("changeYear", yaer);
    // var curLi = $($("#timeLanList li")[7]);
    // if (curLi.hasClass("showTimeLine")) {
    //     curLi.addClass("hideTimeLine");
    //     curLi.removeClass("showTimeLine")
    // }
    // setTimeout(function() {
    //     if (yaer == 2016) {
    //         $("#yearNUM2016").show();
    //         $("#yearNUM2017").hide()
    //     } else if (yaer == 2017) {
    //         $("#yearNUM2017").show();
    //         $("#yearNUM2016").hide()
    //     }
    //     if (curLi.has("hideTimeLine")) {
    //         curLi.addClass("showTimeLine");
    //         curLi.removeClass("hideTimeLine")
    //     }
    // }, 800)
}