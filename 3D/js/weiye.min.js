(function() {
        var planeMusic = $("#planeMusic");
        planeMusic[0].muted = true;
        var text_input = $(".input_text");
        var onOff = false;
        var duration = .5;
        var timer = null;
        var data = {
            code: 0,
            msg: [{
                openid: "test",
                nickname: "你好",
                avatar: "http://img3.imgtn.bdimg.com/it/u=1731020431,1822703354&fm=27&gp=0.jpg",
                brief: ""
            }]
        };
        var current = {};
        var i = null;
        var jiyu = $("#jiyu");
        var plane = $("#plane");
        text_input.on("touchstart", function() {
            text_input.focus()
        });
        var winHeight = $(window).height();
        $(window).on("resize", function() {
            var thisHeight = $(this).height();
            if (winHeight - thisHeight > 50) {
                text_input.focus()
            } else {
                text_input.blur()
            }
        });
        $(document).on("focusin", function() {
            text_input.focus()
        });
        $(document).on("focusout", function() {
            text_input.blur()
        });
        text_input.change(function() {
            onOff = true;
            $("#xie").css("display", "none")
        }).focus(function() {
            $("#xie").css("display", "none")
        });
        $("#choose li").on("touchstart", function() {
            text_input.val($(this).find("img").attr("alt"));
            $("#xie").css("display", "none");
            onOff = true
        });
        var myText1 = $("#myText1");
        var advatar1 = $(".advatar1");
        var SHAKE_THRESHOLD = 480;
        var last_update = 0;
        var x, y, z, last_x, last_y, last_z;
        var num = 0;
        $("#sure_btn").on("touchstart", function() {
            planeMusic[0].play();
            if (!onOff) {
                return
            } else {
                num = 1;
                if (text_input.val()) {
                    window.localStorage.setItem("text", text_input.val());
                    // todo: zora update 注释掉 myconfig（将我输入的内容作为分享的标题）
                    // myconfig.title = getTitle();
                    // window.shareManage && window.shareManage.init(myconfig);
                    // console.log(myconfig.title);
                    // todo: zora update 注释掉最后的ajax请求
                    // $.ajax({
                    //     contentType: "application/json",
                    //     url: window.gg.config.projectUrl + "/Server/update_brief.php",
                    //     type: "get",
                    //     async: false,
                    //     data: {
                    //         openid: window.gg.config.user_info.openid,
                    //         brief: $(".input_text").val()
                    //     },
                    //     success: function(res) {
                    //         // res: {"code":"101","msg":[]}
                    //         data = JSON.parse(res);
                    //         var myMsg = {
                    //             openid: window.gg.config.user_info.openid,
                    //             nickname: window.gg.config.user_info.nickname,
                    //             avatar: window.gg.config.user_info.headimgurl,
                    //             brief: $(".input_text").val()
                    //         };
                    //         data.msg.push(myMsg);
                    //         console.log(data.msg);
                    //         i = data.msg.length - 1;
                    //         current = data.msg[i]
                    //     },
                    //     error: function(XMLHttpRequest, textStatus, errorThrown) {
                    //         data.msg[0].brief = $(".input_text").val();
                    //         i = data.msg.length - 1;
                    //         current = data.msg[i];
                    //         console.log(XMLHttpRequest.status);
                    //         console.log(XMLHttpRequest.readyState);
                    //         console.log(textStatus)
                    //     }
                    // });
                    jiyu.addClass("jiyuLeave");
                    $(".jiyuLeave").bind("animationend", function() {
                        if (jiyu.hasClass("jiyuLeave")) {
                            jiyu.css({
                                display: "none"
                            });
                            $("#aircraft").css("display", "block");
                            jiyu.removeClass("jiyuLeave")
                        }
                        planeMusic[0].pause()
                    })
                }
            }
        });
        if (window.DeviceMotionEvent) {
            window.addEventListener("devicemotion", deviceMotionHandler, false)
        } else {
            return
        }
        $(".plane1").bind("animationend", function() {
            plane.removeClass("plane1")
        });
        function deviceMotionHandler(eventData) {
            if (num === 0) {
                return
            } else {
                var acceleration = eventData.accelerationIncludingGravity;
                var curTime = (new Date).getTime();
                if (curTime - last_update > 300) {
                    var diffTime = curTime - last_update;
                    last_update = curTime;
                    x = acceleration.x;
                    y = acceleration.y;
                    z = acceleration.z;
                    var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 1e4;
                    if (speed > SHAKE_THRESHOLD) {
                        plane.addClass("plane2");
                        $("#audioMusic")[0].pause();
                        planeMusic[0].muted = false;
                        planeMusic[0].play();
                        $(".plane2").bind("animationend", function() {
                            num = 0;
                            $("#aircraft").css("display", "none");
                            $("#share").css({
                                display: "block",
                                left: 0,
                                opacity: "1"
                            });
                            var myText = $("#myText");
                            var jiyu = window.localStorage.getItem("text");
                            lineHeight(current.brief, myText);
                            myText.text(current.brief);
                            $("#advatar").attr("src", current.avatar);
                            $("#nickname").text(current.nickname);
                            $("#audioMusic")[0].play()
                        });
                        console.log(plane.attr("class"))
                    }
                }
                last_x = x;
                last_y = y;
                last_z = z
            }
        }
        $("#refresh_btn").on("touchstart", function() {
            if (!onOff) {
                return
            } else {
                text_input.val("");
                $("#xie").css("display", "block");
                $(".tipClick").css("display", "none")
            }
        });
        $(".agin").on("touchstart", function() {
            window.localStorage.removeItem("text");
            plane.removeClass("plane2");
            num = 0;
            $("#jiyu").css("display", "block");
            $("#share").css("display", "none")
        });
        $(".agin1").on("touchstart", function() {
            window.localStorage.removeItem("text");
            plane.removeClass("plane2");
            num = 0;
            $("#jiyu").css("display", "block");
            $("#others").css("display", "none")
        });
        $(".share").on("touchstart", function() {
            $("#mengban").css("display", "block");
            $("#musicSwich").css("display", "none")
        });


        //todo: zora update 注释掉下面的4行
        // document.getElementById("audioMusic").play();
        // document.addEventLipage_resstener("WeixinJSBridgeReady", function() {
        //     document.getElementById("audioMusic").play()
        // }, false);
        //todo: zora update end

        $(".leftDiv").on("touchstart", function() {
            i--;
            $("#share").animate({
                left: "30rem",
                opacity: "0"
            }, 200, function() {
                $("#others").css({
                    left: "-15rem",
                    display: "block"
                }).animate({
                    left: "0"
                }, 200, function() {
                    $("#share").css("display", "none");
                    lineHeight(current.brief, myText1);
                    myText1.text(current.brief);
                    advatar1.attr("src", current.avatar);
                    $("#nickname1").text(current.nickname)
                })
            });
            if (i < 0) {
                i = data.msg.length - 1
            }
            current = data.msg[i]
        });
        $(".rightDiv").on("touchstart", function() {
            i++;
            $("#share").animate({
                left: "-40rem"
            }, 200, function() {
                $("#others").css({
                    left: "15rem",
                    display: "block"
                }).animate({
                    left: "0"
                }, 200, function() {
                    $("#share").css("display", "none");
                    lineHeight(current.brief, myText1);
                    myText1.text(current.brief);
                    advatar1.attr("src", current.avatar);
                    $("#nickname1").text(current.nickname)
                })
            });
            if (i >= data.msg.length - 1) {
                i = 0
            }
            current = data.msg[i]
        })
    }
)();
function weiyeExecute() {
    $("#weiye").css("display", "block");
    $("#paperDiv").css({
        "animation-name": "jiyuCome",
        "animation-duration": "1.1s",
        "animation-timing-function": "ease-in-out",
        "animation-fill-mode": "forwards"
    })
}
function lineHeight(text, dom) {
    if (text.length < 11) {
        dom.css("top", "2rem")
    } else {
        if (text.length < 22) {
            dom.css("top", "2rem")
        } else {
            dom.css("top", "1.2rem")
        }
    }
}
function getTitle() {
    var brief = $(".input_text").val();
    var title = "";
    if (brief == "我想有个AI女朋友。" || brief == "我觉得AI能帮助人类超脱肉体，得到精神上的永生。" || brief == "我觉得AI能解放人性，让人更像人。") {
        title = brief;
        return title
    } else {
        title = "一分钟看懂AI的前世今生";
        return title
    }
}
